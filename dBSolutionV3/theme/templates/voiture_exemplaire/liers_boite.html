{% extends "base.html" %}
{% load i18n %}

{% block content %}
<h2>{{ title }}</h2>

<form method="post" id="lier-boite-form">
    {% csrf_token %}

    <label for="fabricant">Fabricant</label>
    <input type="text" id="fabricant" name="fabricant">

    <label for="type_de_boite">Type de boîte</label>
    <select id="type_de_boite" name="type_de_boite">
        <option value="">-- Choisir --</option>
    </select>

    <label for="nom_du_type">Nom du type</label>
    <input type="text" id="nom_du_type" name="nom_du_type" readonly>

    <button type="submit">Lier la boîte</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const fabricantInput = document.getElementById("fabricant");
    const typeSelect = document.getElementById("type_de_boite");
    const nomInput = document.getElementById("nom_du_type");

    fabricantInput.addEventListener("change", function() {
        const fabricant = this.value;

        // 1️⃣ récupérer les types de boîte
        fetch(`/fr/voiture/exemplaires/ajax/get_type_de_boite/?fabricant=${fabricant}`)
        .then(response => response.json())
        .then(data => {
            // vider l'ancienne liste
            typeSelect.innerHTML = '<option value="">-- Choisir --</option>';
            data.forEach(type => {
                const option = document.createElement("option");
                option.value = type;
                option.textContent = type;
                typeSelect.appendChild(option);
            });
            nomInput.value = ""; // reset nom du type
        });
    });

    typeSelect.addEventListener("change", function() {
        const type_de_boite = this.value;
        const fabricant = fabricantInput.value;

        if (!type_de_boite) {
            nomInput.value = "";
            return;
        }

        // 2️⃣ récupérer le nom du type
        fetch(`/fr/voiture/exemplaires/ajax/get_nom_du_type/?fabricant=${fabricant}&type_de_boite=${type_de_boite}`)
        .then(response => response.json())
        .then(data => {
            nomInput.value = data.nom_du_type || "";
        });
    });
});
</script>

{% endblock %}
