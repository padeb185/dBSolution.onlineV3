{% extends 'base.html' %}
{% load i18n static %}

{% block content %}
<div class="mx-4 sm:mx-6 lg:mx-8 p-6 w-full">

    <!-- Titre -->
    <h1 class="text-2xl font-bold mb-6">
        {% trans "Exemplaires de" %} {{ modele.nom_modele }}
        {% if modele.nom_variante %}- {{ modele.nom_variante }}{% endif %}
    </h1>

    <!-- Champ de recherche uniquement si des exemplaires existent -->
    {% if exemplaires %}
    <div class="mb-6">
        <input
            type="text"
            id="search-exemplaire"
            class="border rounded-lg px-4 py-2 w-full"
            placeholder="{% trans 'Rechercher un exemplaire par immatriculation...' %}"
        >
    </div>
    {% endif %}

    {% if exemplaires %}
    <!-- Grille des exemplaires + carte "Ajouter" -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="exemplaires-container">
        {% for ex in exemplaires %}
        <div class="bg-white shadow-md hover:shadow-lg transition rounded-lg p-4 flex items-center gap-4 cursor-pointer exemplaire-card"
             data-immatriculation="{{ ex.immatriculation|lower }}"
             onclick="window.location.href='{% url 'voiture_exemplaire:voiture_exemplaire_detail' exemplaire_id=ex.id %}'">

            <!-- Infos de l'exemplaire -->
            <div class="flex-1">
                <h2 class="text-lg font-semibold">{{ ex.immatriculation }}</h2>
                <p class="text-gray-500">
                    {% trans "Année de production" %}: {{ ex.annee_production }}/{{ ex.mois_production }}
                </p>
                <p class="text-gray-500">
                    {% trans "Kilométrage" %}: {{ ex.kilometres_total }} km
                </p>
                {% if ex.couleur %}
                <p class="text-gray-500">
                    {% trans "Couleur" %}: {{ ex.couleur }}
                </p>
                {% endif %}
            </div>

            <!-- Logo de la marque à droite -->
            <div class="flex-shrink-0">
                {% with logo_path="exemplaires/"|add:ex.voiture_modele.voiture_marque.nom_marque|lower|add:".png" %}
                <img src="{% static logo_path %}"
                     onerror="this.onerror=null;this.src='{% static 'exemplaire/default.png' %}';"
                     class="w-[65px] h-[65px] object-contain"
                     alt="{{ ex.voiture_modele.voiture_marque.nom_marque }}">
                {% endwith %}
            </div>

        </div>
        {% endfor %}

        <!-- Carte "Ajouter un exemplaire" -->
        <div class="bg-indigo-100 hover:bg-indigo-200 shadow-md hover:shadow-lg transition rounded-lg p-4 flex items-center justify-center cursor-pointer"
             onclick="window.location.href='{% url 'voiture_exemplaire:ajouter_exemplaire' modele_id=modele.id %}?marque={{ modele.voiture_marque.nom_marque }}&modele={{ modele.nom_modele }}'">
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <p class="mt-2 font-semibold text-indigo-700">{% trans "Ajouter un exemplaire" %}</p>
            </div>
        </div>
    </div>

    {% else %}
    <!-- Aucun exemplaire -->
    <div class="text-center py-10">
        <p class="text-red-600 font-semibold mb-4">
            {% trans "Aucun exemplaire enregistré pour ce modèle." %}
        </p>
        <a href="{% url 'voiture_exemplaire:ajouter_exemplaire' modele_id=modele.id %}?marque={{ modele.voiture_marque.nom_marque }}&modele={{ modele.nom_modele }}"
           class="inline-block px-6 py-3 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
            {% trans "Ajouter un exemplaire" %}
        </a>
    </div>
    {% endif %}

</div>

<!-- JS pour le filtre de recherche -->
<script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
<script>
$(document).ready(function(){
    $('#search-exemplaire').on('input', function(){
        const value = $(this).val().trim().toLowerCase();
        $('.exemplaire-card').each(function(){
            const immat = $(this).data('immatriculation') || '';
            $(this).toggle(!value || immat.includes(value));
        });
    });
});
</script>
{% endblock %}
