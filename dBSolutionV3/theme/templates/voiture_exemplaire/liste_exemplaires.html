{% extends 'base.html' %}
{% load i18n static %}
{% load static %}

{% block content %}

<div class="p-6 w-full ml-[-10px] mr-[10px]">

    <!-- Titre -->
    <h1 class="text-2xl font-bold mb-6">
        {% trans "Exemplaires de " %} {{ modele.voiture_marque.nom_marque }} {{ modele.nom_modele }}
        {% if modele.nom_variante %}- {{ modele.nom_variante }}{% endif %}
    </h1>

    {% if exemplaires %}
    <!-- Champ de recherche -->
    <div class="mb-6">
        <input
            type="text"
            id="search-exemplaire"
            class="border rounded-lg px-4 py-2 w-full"
            placeholder="{% trans 'Rechercher un exemplaire par immatriculation...' %}"
        >
    </div>

    <!-- Grille des exemplaires + carte "Ajouter" -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="exemplaires-container">

        {% for ex in exemplaires %}
        <div class="exemplaire-card bg-white shadow-md transition duration-300 hover:shadow-lg hover:bg-blue-50 rounded-lg p-4 flex flex-col gap-2 cursor-pointer"
             data-immatriculation="{{ ex.immatriculation|lower }}"
             onclick="window.location.href='{% url 'voiture_exemplaire:voiture_exemplaire_detail' exemplaire_id=ex.id %}'">

            <!-- Plaque belge tout en haut -->
            <div class="flex items-center w-[40%] min-w-[180px] h-[40px] bg-white border-2 border-[#8B0000] rounded font-[Arial]">

                <!-- Partie Europe -->
                <div class="flex flex-col items-center justify-center bg-[#003399] text-white font-bold px-[6px] rounded-l text-[18px] leading-none">
                    <span>ðŸ‡ªðŸ‡º</span>
                    <span>B</span>
                </div>

                <!-- Champ plaque -->
                <input
                    type="text"
                    value="{{ ex.immatriculation }}"
                    oninput="this.value = this.value.toUpperCase();"
                    class="w-full text-center border-none font-bold text-[#8B0000] text-[clamp(16px,4vw,24px)] bg-transparent outline-none p-0 m-0"
>
           </div>


            <!-- Infos de l'exemplaire -->
            <div class="flex justify-between items-center mt-2">
                <div>
                    <h2 class="text-lg font-semibold">{{ ex.voiture_modele.voiture_marque.nom_marque }} {{ ex.voiture_modele.nom_modele }}</h2>
                    <p class="text-gray-500">{% trans "AnnÃ©e de production" %}: {{ ex.annee_production }}/{{ ex.mois_production }}</p>
                    <p class="text-gray-500">{% trans "KilomÃ©trage" %}: {{ ex.kilometres_total }} km</p>
                    {% if ex.couleur %}
                    <p class="text-gray-500">{% trans "Couleur" %}: {{ ex.couleur }}</p>
                    {% endif %}
                </div>

                <div class="flex-shrink-0">
                    {% with logo_path="exemplaires/"|add:ex.voiture_modele.voiture_marque.nom_marque|lower|add:".png" %}
                    <img src="{% static logo_path %}"
                         style="width:75px; margin-right:5px;"
                         onerror="this.onerror=null;this.src='{% static 'exemplaire/default.png' %}';"
                         alt="{{ ex.voiture_modele.voiture_marque.nom_marque }}">
                    {% endwith %}
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Carte "Ajouter un exemplaire" -->
       <div class="bg-white shadow-md transition duration-300 hover:shadow-lg hover:bg-blue-50 rounded-lg p-4 flex flex-col justify-center items-center gap-2 cursor-pointer"
             onclick="window.location.href='{% url 'voiture_exemplaire:ajouter_exemplaire' modele_id=modele.id %}'">
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <p class="mt-2 font-semibold text-blue-700">{% trans "Ajouter un exemplaire" %}</p>
            </div>
        </div>

    </div>

    {% else %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-red-50 border border-red-200 shadow-md rounded-lg p-6 flex items-center justify-center">
            <p class="text-red-700 font-semibold text-center">
                {% trans "Aucun exemplaire enregistrÃ© pour ce modÃ¨le." %}
            </p>
        </div>

        <div class="bg-white-100 hover:bg-indigo-200 shadow-md hover:shadow-lg transition rounded-lg p-4 flex items-center justify-center cursor-pointer"
             onclick="window.location.href='{% url 'voiture_exemplaire:ajouter_exemplaire' modele_id=modele.id %}'">
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <p class="mt-2 font-semibold text-blue-700">{% trans "Ajouter un exemplaire" %}</p>
            </div>
        </div>
    </div>
    {% endif %}

</div>

<style>
.plaque-belge {
  display: flex;
  align-items: center;
  width: 40%;
  min-width: 180px;
  background: white;
  border: 2px solid #8B0000;
  border-radius: 4px;
  padding: 4px 8px;
  font-family: Arial, sans-serif;
  font-size: 16px;
}

.plaque-belge .europe {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #003399;
  color: white;
  font-weight: bold;
  padding: 3px 6px;
  border-radius: 3px 0 0 3px;
  margin-right: 5px;
  font-size: 16px;
}

.plaque-complete {
  flex: 1;
  text-align: center;
  border: none;
  font-weight: bold;
  color: #8B0000;
  font-size: 16px;
  background: transparent;
  outline: none;
}
</style>


<!-- JS pour le filtre de recherche -->
<script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
<script>
$(document).ready(function(){
    $('#search-exemplaire').on('input', function(){
        const value = $(this).val().trim().toLowerCase();
        $('.exemplaire-card').each(function(){
            const immat = $(this).data('immatriculation') || '';
            $(this).toggle(!value || immat.includes(value));
        });
    });
});
</script>

{% endblock %}
