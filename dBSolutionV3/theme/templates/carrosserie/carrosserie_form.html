{% extends "base.html" %}
{% load i18n static %}

{% block content %}
<div class="max-w-xl mx-auto p-6 bg-white rounded shadow mt-16 mb-16">

    <!-- Header -->
    <h1 class="text-2xl font-bold mb-4 text-center flex items-center justify-center">
        <img src="{% static 'icons/carrosserie.png' %}"
             style="width:75px; margin-right:5px;"
             alt="{{ request.POST.nom_societe|default:'' }}">
        {% trans "Créer une carrosserie" %}
    </h1>

    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
        <div class="mb-3 px-4 py-2 rounded
            {% if message.tags == 'success' %}
                bg-green-100 text-green-800 border border-green-300
            {% else %}
                bg-red-100 text-red-800 border border-red-300
            {% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    <form method="post" class="flex flex-col space-y-4">
        {% csrf_token %}

        <!-- Carrosserie -->
        <div>
            <label for="id_nom_societe">{% trans "Nom de la carrosserie" %}</label>
            <input type="text" id="id_nom_societe" name="nom_societe"
                   value="{{ request.POST.nom_societe|default:'' }}"
                   class="border rounded px-4 py-2 w-full"
                   placeholder="Nom de la carrosserie">
        </div>

        <div>
            <label for="id_numero_tva">{% trans "Numero de TVA" %}</label>
            <input type="text" id="id_numero_tva" name="numero_tva"
                   value="{{ request.POST.numero_tva|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>

        <div>
            <label for="id_peppol_id">{% trans "Numéro Peppol" %}</label>
            <input type="text" id="id_peppol_id" name="peppol_id"
                   value="{{ request.POST.peppol_id|default:'' }}"
                   class="border rounded px-4 py-2 w-full"
                   placeholder="0208:0630675588">
        </div>

        <div>
            <label for="id_email">{% trans "Email" %}</label>
            <input type="email" id="id_email" name="email"
                   value="{{ request.POST.email|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>

        <div>
            <label for="id_telephone">{% trans "Téléphone" %}</label>
            <input type="text" id="id_telephone" name="telephone"
                   value="{{ request.POST.telephone|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>

        <div>
            <label for="id_responsable_nom">{% trans "Nom du responsable" %}</label>
            <input type="text" id="id_responsable_nom" name="responsable_nom"
                   value="{{ request.POST.responsable_nom|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>

        <div>
            <label for="id_responsable_prenom">{% trans "Prénom du responsable" %}</label>
            <input type="text" id="id_responsable_prenom" name="responsable_prenom"
                   value="{{ request.POST.responsable_prenom|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>

        <!-- Adresse -->
        <h2 class="text-lg font-semibold mt-6 mb-2">{% trans "Adresse" %}</h2>
        <div>
            <label for="id_rue">{% trans "Rue" %}</label>
            <input type="text" id="id_rue" name="rue"
                   value="{{ request.POST.rue|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>
        <div>
            <label for="id_numero">{% trans "Numéro" %}</label>
            <input type="text" id="id_numero" name="numero"
                   value="{{ request.POST.numero|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>
        <div>
            <label for="id_code_postal">{% trans "Code postal" %}</label>
            <input type="text" id="id_code_postal" name="code_postal"
                   value="{{ request.POST.code_postal|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>
        <div>
            <label for="id_ville">{% trans "Ville" %}</label>
            <input type="text" id="id_ville" name="ville"
                   value="{{ request.POST.ville|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>
        <div>
            <label for="id_pays">{% trans "Pays" %}</label>
            <input type="text" id="id_pays" name="pays"
                   value="{{ request.POST.pays|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>
        <div>
            <label for="id_code_pays">{% trans "Code pays" %}</label>
            <input type="text" id="id_code_pays" name="code_pays"
                   value="{{ request.POST.code_pays|default:'' }}"
                   class="border rounded px-4 py-2 w-full">
        </div>

        <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded w-full mt-4">
            {% trans "Enregistrer" %}
        </button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    function formatBankNumber(inputId) {
        const input = document.getElementById(inputId);
        if (!input) return;

        input.addEventListener("input", function () {
            let val = input.value.toUpperCase();

            // Supprime tout sauf lettres et chiffres
            val = val.replace(/[^A-Z0-9]/g, "");

            let formatted = "";
            let i = 0;

            while (i < val.length) {
                if (i === 0) {
                    // deux lettres
                    formatted += val.substr(i, 2);
                    i += 2;
                } else if (i === 2) {
                    // deux chiffres + espace
                    formatted += val.substr(i, 2) + " ";
                    i += 2;
                } else {
                    // groupes de quatre chiffres + espace
                    formatted += val.substr(i, 4) + " ";
                    i += 4;
                }
            }

            // Supprime l'espace final
            input.value = formatted.trim();
        });
    }

    formatBankNumber("id_numero_iban");

});
</script>
{% endblock %}
