{% extends "base.html" %}
{% load i18n static %}

{% block content %}
<div class="max-w-xl mx-auto p-6 bg-white rounded shadow mt-16 mb-16">

    <!-- Titre avec icône -->
    <h1 class="text-2xl font-bold mb-4 text-center flex items-center justify-center">
        <img src="{% static 'icons/engine.png' %}" alt="Moteur" style="width:60px; height:60px; margin-right:10px;">
        {% trans "Ajouter un moteur pour un nouveau véhicule" %} {{ exemplaire }}
    </h1>

    {% for message in messages %}
        <div class="mb-3 text-red-600">{{ message }}</div>
    {% endfor %}

    <form method="post" class="flex flex-col space-y-4">
        {% csrf_token %}

        <!-- Motoriste -->
        <div class="flex flex-col">
            <label for="id_motoriste" class="mb-1 font-medium">{% trans "Motoriste" %}</label>
            <input type="text" id="id_motoriste" name="motoriste"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="{% trans 'Nom du motoriste' %}">
        </div>

        <!-- Code moteur -->
        <div class="flex flex-col">
            <label for="id_code_moteur" class="mb-1 font-medium">{% trans "Code moteur" %}</label>
            <input type="text" id="id_code_moteur" name="code_moteur"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="{% trans 'Ex: S14B23' %}">
        </div>

        <!-- Type moteur -->
        <div class="flex flex-col">
            <label for="id_type_moteur" class="mb-1 font-medium">{% trans "Type moteur" %}</label>
            <input type="text" id="id_type_moteur" name="type_moteur"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="{% trans 'Ex: ATM' %}">
        </div>

        <!-- Carburant -->
        <div class="flex flex-col">
            <label for="id_carburant" class="mb-1 font-medium">{% trans "Carburant" %}</label>
            <input type="text" id="id_carburant" name="carburant"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="{% trans 'Essence / Diesel / ...' %}">
        </div>

        <!-- Cylindrée -->
        <div class="flex flex-col">
            <label for="id_cylindree_l" class="mb-1 font-medium">{% trans "Cylindrée (L)" %}</label>
            <input type="number" step="0.01" id="id_cylindree_l" name="cylindree_l"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="Ex: 2.3">
        </div>

        <!-- Distribution -->
        <div class="flex flex-col">
            <label for="id_distribution" class="mb-1 font-medium">{% trans "Distribution" %}</label>
            <input type="text" id="id_distribution" name="distribution"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="{% trans 'Chaîne / Courroie' %}">
        </div>

        <!-- Nombre de cylindres -->
        <div class="flex flex-col">
            <label for="id_nombre_cylindre" class="mb-1 font-medium">{% trans "Nombre de cylindres" %}</label>
            <input type="number" id="id_nombre_cylindre" name="nombre_cylindre"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="Ex: 4">
        </div>
          <!-- Nombre de chevaux -->
        <div class="flex flex-col">
            <label for="id_puissance_ch" class="mb-1 font-medium">{% trans "Puissance en Chevaux" %}</label>
            <input type="number" id="id_puissance_ch" name="nombre de cheveaux"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="120">
        </div>

        <div class="flex flex-col">
            <label for="id_puissance_tr_min" class="mb-1 font-medium">{% trans "Puissance à tr/min" %}</label>
            <input type="number" id="id_puissance_tr_min" name=""
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="3000">
        </div>

        <div class="flex flex-col">
            <label for="id_couple_nm" class="mb-1 font-medium">{% trans "Couple Nm" %}</label>
            <input type="number" id="id_couple_nm" name="Couple en Nm"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="300">
        </div>

        <div class="flex flex-col">
            <label for="id_couple_tr_min" class="mb-1 font-medium">{% trans "Couple tr/min" %}</label>
            <input type="number" id="id_couple_tr_min" name="couple max"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="">
        </div>

        <div class="flex flex-col">
            <label for="id_qualité_huile" class="mb-1 font-medium">{% trans "Qualité d'huile" %}</label>
            <input type="number" id="id_qualité_huile" name="Qualité d'huile"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="0W30">
        </div>

        <div class="flex flex-col">
            <label for="id_quantite_huile" class="mb-1 font-medium">{% trans "Quantité d'huile" %}</label>
            <input type="number" id="id_quantite_huile" name="Quantité d'huile"
                   class="border border-gray-300 rounded px-4 py-2 w-full"
                   placeholder="6,5">
        </div>


        <!-- Bouton -->
        <button type="submit"
                class="mt-4 bg-blue-600 text-white px-4 py-2 rounded w-full hover:bg-blue-700 transition">
            {% trans "Ajouter" %}
        </button>
    </form>
</div>


<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    document.getElementById('id_motoriste').addEventListener('change', function(){
        const motoriste = this.value;
        fetch('/api/check_nom', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({motoriste: motoriste})
        })
        .then(response => response.json())
        .then(data => {
            if (data.exist) {
                document.getElementById('id_motoriste').value = data.motoriste;
                document.getElementById('id_code_moteur').value = data.code_moteur;
                document.getElementById('id_type_moteur').value = data.type_moteur;
                document.getElementById('id_carburant').value = data.carburant;
                document.getElementById('id_cylindree_l').value = data.cylindree_l;
                document.getElementById('id_distribution').value = data.distribution;
                document.getElementById('id_nombre_cylindre').value = data.nombre_cylindre;
            } else {
                document.getElementById('id_code_moteur').value = '';
                document.getElementById('id_type_moteur').value = '';
                document.getElementById('id_carburant').value = '';
                document.getElementById('id_cylindree_l').value = '';
                document.getElementById('id_distribution').value = '';
                document.getElementById('id_nombre_cylindre').value = '';
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
        });
    });
</script>
{% endblock %}
