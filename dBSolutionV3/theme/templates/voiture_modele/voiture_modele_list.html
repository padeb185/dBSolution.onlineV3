{% extends "base.html" %}
{% load i18n static widget_tweaks %}

{% block title %}{% trans "Liste des Modèles" %}{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6 flex items-center">
    <img src="{% static 'icons/voiture_de_course.png' %}" alt="Modèles"
         style="width:60px; height:60px; margin-right:10px;">
    {% trans "Liste des modèles" %}
</h1>


<div class="bg-white shadow-md rounded-lg p-4 mb-4">
    <div class="flex flex-wrap items-end gap-3">
        <input id="search-voiture_marque" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Nom de la marque' %}">

        <input id="search-nom_modele" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Nom du modèle' %}">

        <input id="search-nom_variante" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[120px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Variante' %}">

        <input id="search-nombre_portes" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Nombre de portes' %}">

        <input id="search-nbre_places" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Nombre de places' %}">

        <input id="search-taille_reservoir" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Capacité du réservoir en litres' %}">

        <input id="search-capacite_batterie" type="text"
               class="border rounded px-3 py-2 flex-1 min-w-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="{% trans 'Capacité de la batterie en kWh' %}">



        <!-- Bouton sur la même ligne -->
        <a href="{% url 'voiture_modele:voiture_modele_create' %}"
           class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-blue-500">
            {% trans "Ajouter un modèle" %}
        </a>
    </div>
</div>



<!-- Table -->
<table id="voiture_modeles-table" class="min-w-full table-auto border-collapse border border-gray-200 bg-white">
    <thead>
        <tr class="bg-gray-100">
            <th class="border px-4 py-2 cursor-pointer">{% trans "Nom de la marque" %}</th>
            <th class="border px-4 py-2 cursor-pointer">{% trans "Nom du modèle" %}</th>
            <th class="border px-4 py-2 cursor-pointer">{% trans "Variante" %}</th>
            <th class="border px-4 py-2 cursor-pointer">{% trans "Nombre de portes" %}</th>
            <th class="border px-4 py-2 cursor-pointer">{% trans "Nombre de places" %}</th>
            <th class="border px-4 py-2 cursor-pointer">{% trans "Capacité du réservoir en litres" %}</th>
            <th class="border px-4 py-2 cursor-pointer">{% trans "Capacité de la batterie en kWh" %}</th>
            <th class="border px-4 py-2 cursor-pointer text-center">{% trans "Info" %}</th>
        </tr>
    </thead>
    <tbody>

        {% for voiture_modele in voiture_modeles %}
        <tr>
            <td class="border px-4 py-2">{{ voiture_modele.voiture_marque }}</td>
            <td class="border px-4 py-2">{{ voiture_modele.nom_modele }}</td>
            <td class="border px-4 py-2">{{ voiture_modele.nom_variante }}</td>
            <td class="border px-4 py-2">{{ voiture_modele.nombre_portes }}</td>
            <td class="border px-4 py-2">{{ voiture_modele.nbre_places }}</td>
            <td class="border px-4 py-2">{{ voiture_modele.taille_reservoir}}</td>
            <td class="border px-4 py-2">{{ voiture_modele.capacite_batterie }}</td>
            <td class="border px-4 py-2 text-center">
                <a href="{% url 'voiture_modele:voiture_modele_detail' voiture_modele.id %}"
                   class="text-blue-600 hover:text-blue-800 font-semibold">
                    {% trans "Info" %}
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>

</table>

<!-- DataTables JS -->
<script>
$(document).ready(function() {
    var table = $('#voiture_modeles-table').DataTable({
        pageLength: 100,
        language: {
            search: "{% trans 'Recherche globale :' %}",
            lengthMenu: "{% trans 'Afficher _MENU_ éléments' %}",
            info: "{% trans 'Affichage de _START_ à _END_ sur _TOTAL_ voiture_modeles' %}",
            infoEmpty: "{% trans 'Aucune voiture_modele trouvé' %}",
            zeroRecords: "{% trans 'Aucun voiture_modele trouvé' %}",
            paginate: {
                first: "{% trans 'Premier' %}",
                last: "{% trans 'Dernier' %}",
                next: "{% trans 'Suivant' %}",
                previous: "{% trans 'Précédent' %}"
            }
        },
        order: [[0, "asc"]]
    });

    // Filtres par colonne
    $('#search-voiture_marque').on('keyup', function () {
        table.column(0).search(this.value).draw();
    });
    $('#search-nom_modele').on('keyup', function () {
        table.column(1).search(this.value).draw();
    });
    $('#search-nom_variante').on('keyup', function () {
        table.column(2).search(this.value).draw();
    });
    $('#search-nombre_portes').on('keyup', function () {
        table.column(3).search(this.value).draw();
    });
     $('#search-nbre_places').on('keyup', function () {
        table.column(4).search(this.value).draw();
    });
     $('#search-taille_reservoir').on('keyup', function () {
        table.column(5).search(this.value).draw();
    });
     $('#search-capacite_batterie').on('keyup', function () {
        table.column(6).search(this.value).draw();
    });

});


document.addEventListener("DOMContentLoaded", function () {

    function formatBankNumber(inputId) {
        const input = document.getElementById(inputId);
        if (!input) return;

        input.addEventListener("input", function () {
            let val = input.value.toUpperCase();

            // Supprime tout sauf lettres et chiffres
            val = val.replace(/[^A-Z0-9]/g, "");

            let formatted = "";
            let i = 0;

            while (i < val.length) {
                if (i === 0) {
                    // deux lettres
                    formatted += val.substr(i, 2);
                    i += 2;
                } else if (i === 2) {
                    // deux chiffres + espace
                    formatted += val.substr(i, 2) + " ";
                    i += 2;
                } else {
                    // groupes de quatre chiffres + espace
                    formatted += val.substr(i, 4) + " ";
                    i += 4;
                }
            }

            // Supprime l'espace final
            input.value = formatted.trim();
        });
    }

    formatBankNumber("id_numero_iban");

});

</script>
{% endblock %}
